FROM cloudcube/base

MAINTAINER DavidZhao <zhaohaibin@outlook.com>

ENV REFRESHED_AT 2016-02-15 15:48

RUN rm /bin/sh && ln -s /bin/bash /bin/sh

RUN \
    apt-get update && \
    apt-get install git curl wget -y && \
    curl -sL https://deb.nodesource.com/setup_4.x | bash - && \
    apt-get install nodejs  -y && \
    npm install -g grunt-cli && \
	npm install -g nrm && \
	rm -rf /var/lib/apt/lits/*

# RUN ln -s "$(which nodejs)" /usr/bin/node

RUN echo "export LC_ALL=C" >> /root/.bashrc

ADD auth/id_rsa_docker /root/.ssh/id_rsa

ADD auth/id_rsa_docker.pub /root/.ssh/id_rsa.pub

RUN chmod 0600 /root/.ssh/*

RUN mkdir -p /root/cache

COPY  configuration/package.json /root/cache/package.json  

COPY  configuration/bower.json /root/cache/bower.json 

WORKDIR /root/cache

RUN npm i

RUN bower i --allow-root

ADD assets /nodeserver

EXPOSE 22

RUN chmod +x /nodeserver/startup

CMD ["/nodeserver/startup"]


